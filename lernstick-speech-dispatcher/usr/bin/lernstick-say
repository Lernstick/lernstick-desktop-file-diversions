#!/bin/sh

# get the voice parameter (default voice for the current user)
VOICE=$1
shift

# save text in temporary file
TEXT_FILE=$(mktemp)
echo "$*" > $TEXT_FILE

# try to auto-detect the language of the text to speak
DETECTED_LANGUAGE="$(java -jar /usr/share/java/tika-app.jar -l $TEXT_FILE 2>/dev/null)"
rm $TEXT_FILE
echo "detected language: \"$DETECTED_LANGUAGE\""
case $DETECTED_LANGUAGE in
	de)
		VOICE="de-DE"
		;;
	en)
		VOICE="en-US"
		;;
esac

WAV_FILE=$(mktemp --suffix .wav)
pico2wave -w $WAV_FILE -l $VOICE "<volume level='50'>$*"
play -q $WAV_FILE treble 20 gain -l 6 2>/dev/null
rm $WAV_FILE
